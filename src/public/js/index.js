import{getArticles as e,getBooks as t}from"./request.js";import{articlesList as a,loadBooks as i,ArticlesHandler as n}from"./generators.js";import{newMessage as r}from"./utils.js";async function handlerLastArticles(){if(null!==localStorage.getItem("time")&&Math.round(new Date().getTime()/1e3)-localStorage.getItem("time")<259200)return;let a=await e(),i=await t();localStorage.setItem("time",Math.round(new Date().getTime()/1e3)),localStorage.setItem("articles_data",JSON.stringify(a)),localStorage.setItem("books_data",JSON.stringify(i))}if(handlerLastArticles(),"/"===location.pathname){let s=localStorage.getItem("articles_data")?JSON.parse(localStorage.getItem("articles_data")):await e();if(200==s.status){document.querySelector(".MainSection__articlesContainer").remove();let m=document.querySelector(".MainSection__articles");m.insertAdjacentElement("beforeend",a(s.data))}i(".MainSection")}if("/articulos"===location.pathname){i(".ArticlesPage__main");let l=new URLSearchParams(location.search).get("page"),o=l&&l>=1?l-1:0,c=new n({page:o});c.create(),document.querySelector(".ArticlesPage__main").addEventListener("click",e=>{let{target:t}=e;switch(t.getAttribute("id")){case"nextPageButton":c.nextPage();break;case"prevPageButton":c.prevPage()}})}if("/contacto"===location.pathname){let d={name:/^[a-zA-ZáéíóúÁÉÍÓÚüÜñÑ\s]{8,50}$/,email:/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/,linkedin:/^(https?:\/\/)?([a-z]+\.)?linkedin\.com\/in\/[a-z0-9_-]+\/?$/i,message:/^.[\w.,-_()áéíóúÁÉÍÓÚüÜñÑ\s\n]{50,500}$/},u=(e,t)=>t.test(e);function g(e,t){return("linkedin"!==e||!(t.length>0))&&"linkedin"===e||u(t,d[e])}function p(e){let t=[];return["name","email","linkedin","message"].forEach(a=>t.push(g(a,e[a]))),!t.includes(!1)}function $(e){let{name:t,value:a}=e;!g(t,a)&&a.length>0?e.classList.add("Form__input--error"):e.classList.remove("Form__input--error")}document.querySelectorAll(".Form__input").forEach(e=>{e.addEventListener("keyup",e=>$(e.target))}),document.querySelector(".Form").addEventListener("submit",async e=>{e.preventDefault();let t=new FormData(e.target),a={name:t.get("name"),email:t.get("email"),linkedin:t.get("linkedin"),message:t.get("message")};if(p(a)){document.querySelector(".Form__submit").classList.add("Form__submit--uploading");let i={service_id:"service_9uivd2t",template_id:"template_pedbl5e",user_id:"7W6DBOmDsZB4m10Pk",template_params:a},n=await fetch("https://api.emailjs.com/api/v1.0/email/send",{method:"POST",body:JSON.stringify(i),headers:{"content-type":"application/json"}});200==n.status?r({message:"Mensaje enviado correctamente"}):r({type:!1,message:"Ocurrio un error mientras se enviaban los datos"}),document.querySelector(".Form__submit").classList.remove("Form__submit--uploading")}})}